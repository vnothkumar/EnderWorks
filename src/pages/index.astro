---
import { getCollection } from "astro:content";
import Pagination from "../components/Pagination.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import Posts from "../components/Posts.astro";
import { SITE_TITLE } from "../consts";

const allPosts = await getCollection("products");

const sorted = allPosts.sort(
  (a, b) =>
    new Date(b.data.created_at).valueOf() -
    new Date(a.data.created_at).valueOf()
);

// Manually paginate for page 1
const pageSize = 12;
const page = {
  data: sorted.slice(0, pageSize),
  currentPage: 1,
  lastPage: Math.ceil(sorted.length / pageSize),
  url: {
    current: "/",
    prev: "/",
    next: sorted.length > pageSize ? "/products/2" : "/",
  },
};
---

<BaseLayout description="Shop the best products on Enderworks." title="">
  <div class="w-full px-4 lg:px-8 py-6">
    <h1 class="text-2xl lg:text-3xl font-bold tracking-tight mb-2">Latest Products</h1>
    <p class="text-base-content/70">Browse our collection of premium tactical equipment</p>
  </div>
  
  <Posts
    posts={page.data.map((post) => ({
      id: post.id,
      slug: post.id,
      data: {
        title: post.data.title,
        images: post.data.images,
        description: post.data.description,
        created_at: post.data.created_at,
        price: post.data.price,
        tags: post.data.tags,
      },
    }))}
  />

  <div class="py-8">
    <Pagination
      length={page.lastPage}
      currentUrl={page.url.current}
      currentPage={page.currentPage}
      firstUrl="/"
      prevUrl={page.url.prev}
      nextUrl={page.url.next}
      lastUrl={`/products/${page.lastPage}`}
    />
  </div>
</BaseLayout>

